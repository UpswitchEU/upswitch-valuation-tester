"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{55673:function(n,e,a){a.d(e,{DownloadService:function(){return r}});var o=a(74177),t=a(61172);class r{static async downloadHTML(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:"html"},a=e.filename||"valuation-report-".concat(Date.now(),".html"),o=new Blob([this.generateStandaloneHTML(n,e)],{type:"text/html"}),t=URL.createObjectURL(o),r=document.createElement("a");r.href=t,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}static async downloadPDF(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:"pdf"};try{let o=await a.e(216).then(a.t.bind(a,57127,23)),r=e.filename||"valuation-report-".concat(Date.now(),".pdf"),i=this.generateStandaloneHTML(n,e),d=document.createElement("div");d.innerHTML=t.C.sanitize(i),d.style.position="absolute",d.style.left="-9999px",document.body.appendChild(d),await o.default().set({margin:[.5,.5,.5,.5],filename:r,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}}).from(d).save(),document.body.removeChild(d)}catch(a){generalLogger.error("PDF generation failed",{error:a}),await this.downloadHTML(n,{...e,format:"html"})}}static generateStandaloneHTML(n,e){let a=new Date().toLocaleDateString(),o=n.companyName||"Company",r=n.valuationAmount?n.valuationAmount.toLocaleString():"N/A",i=n.method||"DCF Analysis",d=n.confidenceScore?Math.round(100*n.confidenceScore):"N/A";return'\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Valuation Report - '.concat(o,'</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n            line-height: 1.6;\n            color: #333;\n            background: #fff;\n        }\n        \n        .header {\n            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n            color: white;\n            padding: 2rem;\n            text-align: center;\n            margin-bottom: 2rem;\n        }\n        \n        .header h1 {\n            font-size: 2.5rem;\n            margin-bottom: 0.5rem;\n            font-weight: 700;\n        }\n        \n        .header .subtitle {\n            font-size: 1.2rem;\n            opacity: 0.9;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 0 2rem;\n        }\n        \n        .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 1.5rem;\n            margin-bottom: 2rem;\n        }\n        \n        .summary-card {\n            background: #f8fafc;\n            border: 1px solid #e2e8f0;\n            border-radius: 8px;\n            padding: 1.5rem;\n            text-align: center;\n        }\n        \n        .summary-card h3 {\n            color: #64748b;\n            font-size: 0.9rem;\n            text-transform: uppercase;\n            letter-spacing: 0.05em;\n            margin-bottom: 0.5rem;\n        }\n        \n        .summary-card .value {\n            font-size: 2rem;\n            font-weight: 700;\n            color: #1e293b;\n        }\n        \n        .content-section {\n            background: white;\n            border: 1px solid #e2e8f0;\n            border-radius: 8px;\n            padding: 2rem;\n            margin-bottom: 2rem;\n        }\n        \n        .content-section h2 {\n            color: #1e293b;\n            font-size: 1.5rem;\n            margin-bottom: 1rem;\n            padding-bottom: 0.5rem;\n            border-bottom: 2px solid #3b82f6;\n        }\n        \n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 1rem;\n        }\n        \n        .metric {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 0.75rem;\n            background: #f1f5f9;\n            border-radius: 6px;\n        }\n        \n        .metric-label {\n            color: #64748b;\n            font-weight: 500;\n        }\n        \n        .metric-value {\n            color: #1e293b;\n            font-weight: 600;\n        }\n        \n        .confidence-bar {\n            width: 100%;\n            height: 8px;\n            background: #e2e8f0;\n            border-radius: 4px;\n            overflow: hidden;\n            margin-top: 0.5rem;\n        }\n        \n        .confidence-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #3b82f6, #8b5cf6);\n            border-radius: 4px;\n            transition: width 0.3s ease;\n        }\n        \n        .footer {\n            margin-top: 3rem;\n            padding: 2rem;\n            background: #f8fafc;\n            border-top: 1px solid #e2e8f0;\n            text-align: center;\n            color: #64748b;\n        }\n        \n        .branding {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 0.5rem;\n            margin-top: 1rem;\n        }\n        \n        .branding .logo {\n            width: 24px;\n            height: 24px;\n            background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n            border-radius: 4px;\n        }\n        \n        @media print {\n            .header {\n                background: #1e293b !important;\n                -webkit-print-color-adjust: exact;\n                color-adjust: exact;\n            }\n            \n            .summary-card {\n                border: 1px solid #e2e8f0 !important;\n            }\n            \n            .content-section {\n                border: 1px solid #e2e8f0 !important;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>Valuation Report</h1>\n        <div class="subtitle">').concat(o," â€¢ ").concat(a,'</div>\n    </div>\n    \n    <div class="container">\n        <div class="summary-grid">\n            <div class="summary-card">\n                <h3>Valuation Amount</h3>\n                <div class="value">$').concat(r,'</div>\n            </div>\n            <div class="summary-card">\n                <h3>Method</h3>\n                <div class="value">').concat(i,'</div>\n            </div>\n            <div class="summary-card">\n                <h3>Confidence</h3>\n                <div class="value">').concat(d,'%</div>\n            </div>\n        </div>\n        \n        <div class="content-section">\n            <h2>Valuation Details</h2>\n            <div class="metrics-grid">\n                <div class="metric">\n                    <span class="metric-label">Company</span>\n                    <span class="metric-value">').concat(o,'</span>\n                </div>\n                <div class="metric">\n                    <span class="metric-label">Method</span>\n                    <span class="metric-value">').concat(i,'</span>\n                </div>\n                <div class="metric">\n                    <span class="metric-label">Date</span>\n                    <span class="metric-value">').concat(a,'</span>\n                </div>\n                <div class="metric">\n                    <span class="metric-label">Confidence Score</span>\n                    <span class="metric-value">').concat(d,"%</span>\n                </div>\n            </div>\n        </div>\n        \n        ").concat(n.htmlContent?'\n        <div class="content-section">\n            <h2>Detailed Analysis</h2>\n            <div style="margin-top: 1rem;">\n                '.concat(t.C.sanitize(n.htmlContent),"\n            </div>\n        </div>\n        "):"",'\n    </div>\n    \n    <div class="footer">\n        <p>Generated by Upswitch Valuation Engine</p>\n        <div class="branding">\n            <div class="logo"></div>\n            <span>Upswitch</span>\n        </div>\n    </div>\n</body>\n</html>')}static async downloadAccountantViewPDF(n,e){let a=performance.now(),t="pdf_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));try{generalLogger.info("[DownloadService] PDF download initiated",{downloadId:t,company_name:n.company_name,timestamp:new Date().toISOString(),hasSignal:!!(null==e?void 0:e.signal),hasProgressCallback:!!(null==e?void 0:e.onProgress)});let r=(null==e?void 0:e.filename)||this.getDefaultFilename(n.company_name,"pdf");generalLogger.debug("[DownloadService] PDF filename determined",{downloadId:t,filename:r,company_name:n.company_name}),(null==e?void 0:e.onProgress)&&(e.onProgress(0),generalLogger.debug("[DownloadService] Progress callback initialized",{downloadId:t,progress:0}));let i=performance.now();generalLogger.debug("[DownloadService] Calling backend API for PDF generation",{downloadId:t,company_name:n.company_name,endpoint:"/api/valuations/pdf/accountant-view"});let d=await o.T.downloadAccountantViewPDF(n,{signal:null==e?void 0:e.signal,onProgress:a=>{(null==e?void 0:e.onProgress)&&e.onProgress(a),generalLogger.debug("[DownloadService] PDF download progress",{downloadId:t,progress:a,company_name:n.company_name})}}),c=performance.now()-i;generalLogger.debug("[DownloadService] Backend API call completed",{downloadId:t,company_name:n.company_name,pdfSize:d.size,pdfSizeKB:Math.round(d.size/1024),apiCallDurationMs:Math.round(c),contentType:d.type||"application/pdf"}),(null==e?void 0:e.onProgress)&&(e.onProgress(100),generalLogger.debug("[DownloadService] Progress set to 100%",{downloadId:t}));let l=performance.now();generalLogger.debug("[DownloadService] Initiating browser download",{downloadId:t,filename:r,pdfSize:d.size});let s=URL.createObjectURL(d),m=document.createElement("a");m.href=s,m.download=r,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(s);let g=performance.now()-l,p=performance.now()-a;generalLogger.info("[DownloadService] PDF download completed successfully",{downloadId:t,filename:r,pdfSize:d.size,pdfSizeKB:Math.round(d.size/1024),downloadDurationMs:Math.round(g),totalDurationMs:Math.round(p),company_name:n.company_name,timestamp:new Date().toISOString()})}catch(r){let e=performance.now()-a,o={downloadId:t,company_name:n.company_name,error:r instanceof Error?r.message:"Unknown error",errorType:r instanceof Error?r.constructor.name:typeof r,durationMs:Math.round(e),timestamp:new Date().toISOString()};if(generalLogger.error("[DownloadService] PDF download failed",o),r instanceof Error&&r.stack&&generalLogger.error("[DownloadService] Error stack trace",{downloadId:t,stack:r.stack}),r instanceof Error)throw Error("Failed to download PDF: ".concat(r.message));throw Error("Failed to download PDF: Unknown error")}}static getDefaultFilename(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"html",a=new Date().toISOString().split("T")[0],o=n?n.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase():"company";return"".concat(o,"-valuation-").concat(a,".").concat(e)}}}}]);