"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{55673:function(n,e,t){t.d(e,{DownloadService:function(){return r}});var a=t(74177),o=t(61172);class r{static async downloadHTML(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:"html"},t=e.filename||"valuation-report-".concat(Date.now(),".html"),a=new Blob([this.generateStandaloneHTML(n,e)],{type:"text/html"}),o=URL.createObjectURL(a),r=document.createElement("a");r.href=o,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}static async downloadPDF(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:"pdf"};try{let a=await Promise.all([t.e(125),t.e(505),t.e(632),t.e(337),t.e(729)]).then(t.t.bind(t,57127,23)),r=e.filename||"valuation-report-".concat(Date.now(),".pdf"),i=this.generateStandaloneHTML(n,e),c=document.createElement("div");c.innerHTML=o.C.sanitize(i),c.style.position="absolute",c.style.left="-9999px",document.body.appendChild(c),await a.default().set({margin:[.5,.5,.5,.5],filename:r,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}}).from(c).save(),document.body.removeChild(c)}catch(t){generalLogger.error("PDF generation failed",{error:t}),await this.downloadHTML(n,{...e,format:"html"})}}static generateStandaloneHTML(n,e){let t=new Date().toLocaleDateString(),a=n.companyName||"Company",r=n.valuationAmount?n.valuationAmount.toLocaleString():"N/A",i=n.method||"DCF Analysis",c=n.confidenceScore?Math.round(100*n.confidenceScore):"N/A";return'\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Valuation Report - '.concat(a,'</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n            line-height: 1.6;\n            color: #333;\n            background: #fff;\n        }\n        \n        .header {\n            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n            color: white;\n            padding: 2rem;\n            text-align: center;\n            margin-bottom: 2rem;\n        }\n        \n        .header h1 {\n            font-size: 2.5rem;\n            margin-bottom: 0.5rem;\n            font-weight: 700;\n        }\n        \n        .header .subtitle {\n            font-size: 1.2rem;\n            opacity: 0.9;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 0 2rem;\n        }\n        \n        .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 1.5rem;\n            margin-bottom: 2rem;\n        }\n        \n        .summary-card {\n            background: #f8fafc;\n            border: 1px solid #e2e8f0;\n            border-radius: 8px;\n            padding: 1.5rem;\n            text-align: center;\n        }\n        \n        .summary-card h3 {\n            color: #64748b;\n            font-size: 0.9rem;\n            text-transform: uppercase;\n            letter-spacing: 0.05em;\n            margin-bottom: 0.5rem;\n        }\n        \n        .summary-card .value {\n            font-size: 2rem;\n            font-weight: 700;\n            color: #1e293b;\n        }\n        \n        .content-section {\n            background: white;\n            border: 1px solid #e2e8f0;\n            border-radius: 8px;\n            padding: 2rem;\n            margin-bottom: 2rem;\n        }\n        \n        .content-section h2 {\n            color: #1e293b;\n            font-size: 1.5rem;\n            margin-bottom: 1rem;\n            padding-bottom: 0.5rem;\n            border-bottom: 2px solid #3b82f6;\n        }\n        \n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 1rem;\n        }\n        \n        .metric {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 0.75rem;\n            background: #f1f5f9;\n            border-radius: 6px;\n        }\n        \n        .metric-label {\n            color: #64748b;\n            font-weight: 500;\n        }\n        \n        .metric-value {\n            color: #1e293b;\n            font-weight: 600;\n        }\n        \n        .confidence-bar {\n            width: 100%;\n            height: 8px;\n            background: #e2e8f0;\n            border-radius: 4px;\n            overflow: hidden;\n            margin-top: 0.5rem;\n        }\n        \n        .confidence-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #3b82f6, #8b5cf6);\n            border-radius: 4px;\n            transition: width 0.3s ease;\n        }\n        \n        .footer {\n            margin-top: 3rem;\n            padding: 2rem;\n            background: #f8fafc;\n            border-top: 1px solid #e2e8f0;\n            text-align: center;\n            color: #64748b;\n        }\n        \n        .branding {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 0.5rem;\n            margin-top: 1rem;\n        }\n        \n        .branding .logo {\n            width: 24px;\n            height: 24px;\n            background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n            border-radius: 4px;\n        }\n        \n        @media print {\n            .header {\n                background: #1e293b !important;\n                -webkit-print-color-adjust: exact;\n                color-adjust: exact;\n            }\n            \n            .summary-card {\n                border: 1px solid #e2e8f0 !important;\n            }\n            \n            .content-section {\n                border: 1px solid #e2e8f0 !important;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>Valuation Report</h1>\n        <div class="subtitle">').concat(a," â€¢ ").concat(t,'</div>\n    </div>\n    \n    <div class="container">\n        <div class="summary-grid">\n            <div class="summary-card">\n                <h3>Valuation Amount</h3>\n                <div class="value">$').concat(r,'</div>\n            </div>\n            <div class="summary-card">\n                <h3>Method</h3>\n                <div class="value">').concat(i,'</div>\n            </div>\n            <div class="summary-card">\n                <h3>Confidence</h3>\n                <div class="value">').concat(c,'%</div>\n            </div>\n        </div>\n        \n        <div class="content-section">\n            <h2>Valuation Details</h2>\n            <div class="metrics-grid">\n                <div class="metric">\n                    <span class="metric-label">Company</span>\n                    <span class="metric-value">').concat(a,'</span>\n                </div>\n                <div class="metric">\n                    <span class="metric-label">Method</span>\n                    <span class="metric-value">').concat(i,'</span>\n                </div>\n                <div class="metric">\n                    <span class="metric-label">Date</span>\n                    <span class="metric-value">').concat(t,'</span>\n                </div>\n                <div class="metric">\n                    <span class="metric-label">Confidence Score</span>\n                    <span class="metric-value">').concat(c,"%</span>\n                </div>\n            </div>\n        </div>\n        \n        ").concat(n.htmlContent?'\n        <div class="content-section">\n            <h2>Detailed Analysis</h2>\n            <div style="margin-top: 1rem;">\n                '.concat(o.C.sanitize(n.htmlContent),"\n            </div>\n        </div>\n        "):"",'\n    </div>\n    \n    <div class="footer">\n        <p>Generated by Upswitch Valuation Engine</p>\n        <div class="branding">\n            <div class="logo"></div>\n            <span>Upswitch</span>\n        </div>\n    </div>\n</body>\n</html>')}static async downloadAccountantViewPDF(n,e){let t=performance.now(),o="pdf_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));try{generalLogger.info("[DownloadService] PDF download initiated",{downloadId:o,company_name:n.company_name,timestamp:new Date().toISOString(),hasSignal:!!(null==e?void 0:e.signal),hasProgressCallback:!!(null==e?void 0:e.onProgress)});let r=(null==e?void 0:e.filename)||this.getDefaultFilename(n.company_name,"pdf");generalLogger.debug("[DownloadService] PDF filename determined",{downloadId:o,filename:r,company_name:n.company_name}),(null==e?void 0:e.onProgress)&&(e.onProgress(0),generalLogger.debug("[DownloadService] Progress callback initialized",{downloadId:o,progress:0}));let i=performance.now();generalLogger.debug("[DownloadService] Calling backend API for PDF generation",{downloadId:o,company_name:n.company_name,endpoint:"/api/valuations/pdf/accountant-view"});let c=await a.T.downloadAccountantViewPDF(n,{signal:null==e?void 0:e.signal,onProgress:t=>{(null==e?void 0:e.onProgress)&&e.onProgress(t),generalLogger.debug("[DownloadService] PDF download progress",{downloadId:o,progress:t,company_name:n.company_name})}}),l=performance.now()-i;generalLogger.debug("[DownloadService] Backend API call completed",{downloadId:o,company_name:n.company_name,pdfSize:c.size,pdfSizeKB:Math.round(c.size/1024),apiCallDurationMs:Math.round(l),contentType:c.type||"application/pdf"}),(null==e?void 0:e.onProgress)&&(e.onProgress(100),generalLogger.debug("[DownloadService] Progress set to 100%",{downloadId:o}));let s=performance.now();generalLogger.debug("[DownloadService] Initiating browser download",{downloadId:o,filename:r,pdfSize:c.size});let d=URL.createObjectURL(c),m=document.createElement("a");m.href=d,m.download=r,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(d);let g=performance.now()-s,p=performance.now()-t;generalLogger.info("[DownloadService] PDF download completed successfully",{downloadId:o,filename:r,pdfSize:c.size,pdfSizeKB:Math.round(c.size/1024),downloadDurationMs:Math.round(g),totalDurationMs:Math.round(p),company_name:n.company_name,timestamp:new Date().toISOString()})}catch(r){let e=performance.now()-t,a={downloadId:o,company_name:n.company_name,error:r instanceof Error?r.message:"Unknown error",errorType:r instanceof Error?r.constructor.name:typeof r,durationMs:Math.round(e),timestamp:new Date().toISOString()};if(generalLogger.error("[DownloadService] PDF download failed",a),r instanceof Error&&r.stack&&generalLogger.error("[DownloadService] Error stack trace",{downloadId:o,stack:r.stack}),r instanceof Error)throw Error("Failed to download PDF: ".concat(r.message));throw Error("Failed to download PDF: Unknown error")}}static getDefaultFilename(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"html",t=new Date().toISOString().split("T")[0],a=n?n.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase():"company";return"".concat(a,"-valuation-").concat(t,".").concat(e)}}},61172:function(n,e,t){t.d(e,{C:function(){return o}});var a=t(1581);t(69419);class o{static extractCSS(n){let e;let t=/<style(?:\s+[^>]*)?>([\s\S]*?)<\/style>/gi,a="",o=n;for(;null!==(e=t.exec(n));)a+=e[1]+"\n",o=o.replace(e[0],"");return{css:a.trim(),html:o}}static sanitize(n){let e;if(!n||"string"!=typeof n)return"";let t="",o=n,r=!1;try{let e=this.extractCSS(n);t=e.css,o=e.html,r=t.length>0}catch(e){o=n,r=!1}try{e=a.default.sanitize(o,{ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","div","span","strong","em","b","i","u","ul","ol","li","br","hr","table","thead","tbody","tr","th","td","a","img","blockquote","pre","code","section","article","header","footer","style"],ALLOWED_ATTR:["class","id","style","href","src","alt","title","colspan","rowspan","align","valign","type","media"],ALLOW_DATA_ATTR:!0,ALLOW_UNKNOWN_PROTOCOLS:!1,FORCE_BODY:!0,KEEP_CONTENT:!0})}catch(n){return""}return"string"!=typeof e?"":r&&t.length>0&&!(e.includes("<style>")||e.includes("<style "))?"<style>".concat(t,"</style>").concat(e):e}static process(n){if(!n)return"";let e=this.sanitize(n);return this.processLinks(e)}static processLinks(n){return n.replace(/<a\s+href=/g,'<a target="_blank" rel="noopener noreferrer" href=')}static extractSections(n){if(!n||"string"!=typeof n)return[];try{let e=new DOMParser().parseFromString(n,"text/html").querySelectorAll("h2, h3, h4");return Array.from(e).map((n,e)=>({id:"section-".concat(e),title:n.textContent||"",level:parseInt(n.tagName.charAt(1),10)||2}))}catch(n){return[]}}static isSafe(n){return!n||this.sanitize(n)===n}}}}]);