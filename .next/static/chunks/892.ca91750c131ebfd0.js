"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{65892:function(e,a,l){l.r(a),l.d(a,{ValuationFlow:function(){return f}});var n=l(57437),o=l(2265),s=l(30761),t=l(38691),i=l(69419);let r=(0,o.lazy)(()=>l.e(134).then(l.bind(l,31134)).then(e=>({default:e.Results}))),d=(0,o.lazy)(()=>Promise.all([l.e(4),l.e(216),l.e(493),l.e(404)]).then(l.bind(l,96629)).then(e=>({default:e.StreamingChat}))),c=(0,o.lazy)(()=>Promise.all([l.e(4),l.e(493),l.e(519)]).then(l.bind(l,519)).then(e=>({default:e.ValuationToolbar}))),u=(0,o.lazy)(()=>Promise.all([l.e(4),l.e(985)]).then(l.bind(l,9985)).then(e=>({default:e.DataCollection}))),m=e=>{let{message:a="Loading..."}=e;return(0,n.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"}),(0,n.jsx)("span",{className:"text-zinc-600",children:a})]})})},f=e=>{let{reportId:a,flowType:l,onComplete:s,initialQuery:t=null,autoSend:i=!1}=e;return"conversational"===l?(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)(m,{message:"Loading conversational flow..."}),children:(0,n.jsx)(d,{sessionId:a,userId:void 0,onMessageComplete:()=>{},onValuationComplete:s,onValuationStart:()=>{},onReportUpdate:()=>{},onDataCollected:()=>{},onValuationPreview:()=>{},onCalculateOptionAvailable:()=>{},initialMessage:t||void 0,autoSend:i})}):(0,n.jsx)(p,{reportId:a,onComplete:s})},p=e=>{let{reportId:a,onComplete:d}=e,{result:f,isCalculating:p,calculateValuation:h,setCollectedData:x}=(0,t.useValuationStore)(),{user:b}=(0,s.a)(),v=(0,o.useCallback)(e=>{x(e)},[x]),g=(0,o.useCallback)(async e=>{x(e);try{await h()}catch(e){i.a.error("Valuation calculation failed",{error:e,reportId:a})}},[x,h,a]),j=(0,o.useCallback)(e=>{i.a.debug("Manual flow progress update",{progress:e.overallProgress,completedFields:e.completedFields,totalFields:e.totalFields})},[]);return(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)(m,{message:"Loading data collection..."}),children:(0,n.jsx)(u,{method:"manual_form",onDataCollected:v,onProgressUpdate:j,onComplete:g})})}),(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)(m,{message:"Loading toolbar..."}),children:(0,n.jsx)(c,{onRefresh:()=>window.location.reload(),onDownload:async()=>{if(f)try{let{DownloadService:e}=await Promise.all([l.e(216),l.e(493),l.e(673)]).then(l.bind(l,55673));await e.downloadPDF(f,{format:"pdf",filename:"valuation-".concat(Date.now(),".pdf")})}catch(e){i.a.error("PDF download failed",{error:e,reportId:a})}},onFullScreen:()=>{},isGenerating:p,user:b,valuationName:"Manual Valuation",valuationId:null==f?void 0:f.valuation_id,activeTab:"preview",onTabChange:()=>{}})}),f&&(0,n.jsx)("div",{className:"border-t border-gray-200",children:(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)(m,{message:"Loading results..."}),children:(0,n.jsx)(r,{})})})]})};p.displayName="ManualFlow",f.displayName="ValuationFlow"}}]);