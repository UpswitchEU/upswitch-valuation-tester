"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[519],{61173:function(e,t,n){n.d(t,{w:function(){return u}});var a=n(57437),s=n(83852),i=n(24258),r=n(89896),o=n(43267),l=n(30690),c=n(52022),d=n(2265);let u=e=>{let{user:t,onLogout:n}=e,[u,m]=(0,d.useState)(!1),x=(0,d.useRef)(null),h=(0,d.useRef)(null),[p,w]=(0,d.useState)({top:0,right:0});(0,d.useEffect)(()=>{if(u&&h.current){let e=h.current.getBoundingClientRect();w({top:e.bottom+8,right:window.innerWidth-e.right})}},[u]),(0,d.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&m(!1)};return u&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[u]),(0,d.useEffect)(()=>{let e=e=>{"Escape"===e.key&&u&&m(!1)};return u&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[u]);let v=()=>{if(!(null==t?void 0:t.name))return"?";let e=t.name.split(" ");return e.length>=2?"".concat(e[0][0]).concat(e[1][0]).toUpperCase():t.name.substring(0,2).toUpperCase()},g=(null==t?void 0:t.avatar_url)||(null==t?void 0:t.avatar),b=!!g,f=async()=>{m(!1),await n()},j=[{key:"back-to-dashboard",icon:s.Z,label:"Back to Dashboard",action:()=>{m(!1),window.parent&&window.parent!==window?window.parent.postMessage({type:"NAVIGATE_TO_DASHBOARD"},"*"):window.open("https://upswitch.biz/my-business","_blank")}},{key:"account-settings",icon:i.Z,label:"Account Settings",action:()=>{m(!1),window.parent&&window.parent!==window?window.parent.postMessage({type:"NAVIGATE_TO_SETTINGS"},"*"):window.open("https://upswitch.biz/users/profile","_blank")}},{key:"divider-1",isDivider:!0},{key:"logout",icon:r.Z,label:"Log Out",action:f}],y=[{key:"create-account",icon:o.Z,label:"Create Account",action:()=>{m(!1),window.parent&&window.parent!==window?window.parent.postMessage({type:"OPEN_SIGNUP"},"*"):window.open("https://upswitch.biz/signup","_blank")}},{key:"divider-1",isDivider:!0},{key:"learn-more",icon:l.Z,label:"Learn More",action:()=>{m(!1),window.parent&&window.parent!==window?window.parent.postMessage({type:"NAVIGATE_TO_VALUATION"},"*"):window.open("https://upswitch.biz/valuation","_blank")}}],N=t?j:y;return(0,a.jsxs)("div",{ref:x,className:"relative",style:{zIndex:100},children:[(0,a.jsx)("button",{ref:h,onClick:()=>{m(e=>!e)},className:"flex items-center justify-center w-10 h-10 sm:w-8 sm:h-8 rounded-full bg-gray-200 text-gray-700 text-sm font-medium hover:bg-gray-300 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2","aria-label":t?"".concat(t.name||t.email," - Account Menu"):"Guest - Account Menu","aria-expanded":u,"aria-haspopup":"true",style:{position:"relative",zIndex:101},children:t?(0,a.jsxs)(a.Fragment,{children:[b?(0,a.jsx)("img",{src:g||"",alt:(null==t?void 0:t.name)||"User",className:"w-full h-full rounded-full object-cover",loading:"lazy",onError:e=>{var t;e.currentTarget.style.display="none",null===(t=e.currentTarget.nextElementSibling)||void 0===t||t.classList.remove("hidden")}}):null,(0,a.jsx)("span",{className:b?"hidden":"block",children:v()})]}):(0,a.jsx)(c.Z,{className:"w-4 h-4 text-gray-600"})}),u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-[9998]",onClick:()=>m(!1),"aria-hidden":"true"}),(0,a.jsxs)("div",{className:"fixed w-56 bg-zinc-900 rounded-lg shadow-lg border border-zinc-800 py-2 z-[9999]",style:{top:"".concat(p.top,"px"),right:"".concat(p.right,"px")},children:[(0,a.jsx)("div",{className:"px-4 py-3 border-b border-zinc-800",children:t?(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"w-8 h-8 bg-zinc-700 rounded-full flex items-center justify-center flex-shrink-0",children:[b?(0,a.jsx)("img",{src:g||"",alt:(null==t?void 0:t.name)||"User",className:"w-full h-full rounded-full object-cover",loading:"lazy",onError:e=>{var t;e.currentTarget.style.display="none",null===(t=e.currentTarget.nextElementSibling)||void 0===t||t.classList.remove("hidden")}}):null,(0,a.jsx)("span",{className:b?"hidden":"block text-white text-sm font-medium",children:v()})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-white truncate",children:t.name||"User"}),(0,a.jsx)("div",{className:"text-xs text-zinc-400 truncate",children:t.email})]})]}):(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-white",children:"Welcome, Guest"}),(0,a.jsx)("p",{className:"text-xs text-zinc-400",children:"Sign in to access your dashboard"})]})}),(0,a.jsx)("div",{className:"py-2",children:N.map((e,t)=>{if(e.isDivider)return(0,a.jsx)("div",{className:"h-px bg-zinc-800 my-1",role:"separator"},t);let n=e.icon,s=0===t,i=t===N.length-1,r="logout"===e.key;return(0,a.jsxs)("button",{onClick:t=>{var n;t.preventDefault(),t.stopPropagation(),null===(n=e.action)||void 0===n||n.call(e)},className:"\n                      w-full flex items-center gap-3 px-4 py-4 sm:py-3 text-base sm:text-sm font-medium text-left border-0 bg-transparent\n                      transition-colors duration-150\n                      ".concat(s?"rounded-t-xl":"","\n                      ").concat(i?"rounded-b-xl":"","\n                      ").concat(r?"hover:bg-red-900/20 text-red-400 hover:text-red-300":"hover:bg-zinc-800/50 text-zinc-300 hover:text-white","\n                    "),role:"menuitem",tabIndex:0,children:[n&&(0,a.jsx)(n,{className:"w-5 h-5 sm:w-4 sm:h-4 flex-shrink-0 ".concat(r?"text-red-400":"text-zinc-400")}),(0,a.jsx)("span",{className:"flex-1",children:e.label})]},t)})})]})]})]})}},519:function(e,t,n){n.r(t),n.d(t,{ValuationToolbar:function(){return N}});var a=n(57437),s=n(3274),i=n(39451),r=n(47390),o=n(75733),l=n(7746),c=n(30690),d=n(66706),u=n(37164),m=n(35820),x=n(2265),h=n(30761),p=n(65030),w=n(69419),v=n(69302),g=n(36127),b=n(54887);let f=e=>{let{isOpen:t,onClose:n,onConfirm:s,targetFlow:i,currentFlow:r}=e;if(!t)return null;let o={manual:"Manual Entry",conversational:"AI-Guided"},l="conversational"===i?"Conversational":"Manual",c=r?o[r]:null,d=(0,a.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/65",onClick:n,"aria-hidden":"false"}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center p-4","aria-hidden":"false","aria-modal":"true",role:"dialog",children:(0,a.jsxs)("div",{className:"bg-zinc-800 rounded-2xl shadow-2xl border border-zinc-700 max-w-md w-full",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:"px-6 py-5 border-b border-zinc-700",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-primary-500/10 flex items-center justify-center",children:(0,a.jsx)(g.Z,{className:"w-5 h-5 text-primary-500"})}),(0,a.jsxs)("h2",{className:"text-xl font-semibold text-white",children:["Switch to ",l," Flow?"]})]})}),(0,a.jsxs)("div",{className:"px-6 py-5 space-y-3",children:[(0,a.jsx)("p",{className:"text-zinc-300 leading-relaxed",children:c?(0,a.jsxs)(a.Fragment,{children:["Switch from ",(0,a.jsx)("span",{className:"font-semibold text-white",children:c})," to"," ",(0,a.jsx)("span",{className:"font-semibold text-white",children:o[i]}),"?"]}):(0,a.jsxs)(a.Fragment,{children:["Switch to the ",l.toLowerCase()," flow?"]})}),(0,a.jsx)("p",{className:"text-zinc-400 text-sm leading-relaxed",children:"Your entered data will be preserved. You can switch between flows at any time without losing your progress."})]}),(0,a.jsxs)("div",{className:"px-6 py-4 bg-zinc-900/50 rounded-b-2xl flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-zinc-300 hover:text-white transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:s,className:"px-4 py-2 text-sm font-medium bg-accent-600 hover:bg-accent-500 text-white rounded-lg transition-colors",children:"Switch Flow"})]})]})})]});return"undefined"!=typeof document&&document.body?(0,b.createPortal)(d,document.body):d};var j=n(61173);let y=e=>{let{content:t,children:n,position:s="top",delay:i=300,className:r="cursor-help border-b border-dotted border-gray-400"}=e,[o,l]=(0,x.useState)(!1),[c,d]=(0,x.useState)(!1),[u,m]=(0,x.useState)(null),h=(0,x.useRef)(null),p=(0,x.useRef)(null);return(0,x.useEffect)(()=>{d("ontouchstart"in window)},[]),(0,x.useEffect)(()=>{if(!c||!o)return;let e=e=>{h.current&&!h.current.contains(e.target)&&p.current&&!p.current.contains(e.target)&&l(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[c,o]),(0,x.useEffect)(()=>()=>{u&&clearTimeout(u)},[u]),(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("div",{ref:p,role:"tooltip","aria-label":t,onClick:e=>{c&&(e.preventDefault(),e.stopPropagation(),l(!o))},onMouseEnter:c?void 0:()=>{c||m(setTimeout(()=>l(!0),i))},onMouseLeave:c?void 0:()=>{u&&(clearTimeout(u),m(null)),l(!1)},onFocus:()=>l(!0),onBlur:()=>l(!1),tabIndex:0,className:r,children:n}),o&&(0,a.jsxs)("div",{ref:h,className:"absolute z-50 px-3 py-2 text-sm text-white bg-gray-900 \n            rounded-lg shadow-lg whitespace-nowrap transition-opacity duration-200\n            ".concat("top"===s?"bottom-full mb-2 left-1/2 -translate-x-1/2":"","\n            ").concat("bottom"===s?"top-full mt-2 left-1/2 -translate-x-1/2":"","\n          "),children:[t,(0,a.jsx)("div",{className:"absolute w-2 h-2 bg-gray-900 rotate-45\n            ".concat("top"===s?"bottom-[-4px] left-1/2 -translate-x-1/2":"","\n            ").concat("bottom"===s?"top-[-4px] left-1/2 -translate-x-1/2":"","\n          ")})]})]})},N=e=>{let{onRefresh:t,onDownload:n,onFullScreen:g,isGenerating:b=!1,user:N,valuationName:k="Valuation test123",activeTab:z="preview",onTabChange:C,companyName:E}=e,{refreshAuth:_}=(0,h.a)(),{session:S,switchView:L,pendingFlowSwitch:T,setPendingFlowSwitch:V,isSyncing:A}=(0,p.L)(),[Z,I]=(0,x.useState)(!1);(0,x.useEffect)(()=>{T?I(!0):I(!1)},[T]);let F=async e=>{if(!S||S.currentView===e)return;let t=await L(e,!1,!1);(null==t?void 0:t.needsConfirmation)&&I(!0)},M=async()=>{T&&(await L(T,!1,!0),I(!1),V(null))},[D,O]=(0,x.useState)(!1),[P,R]=(0,x.useState)(k),[U,G]=(0,x.useState)(()=>E?v.K.generateFromCompany(E):v.K.generateValuationName()),B=(0,x.useRef)(null);(0,x.useEffect)(()=>{D&&B.current&&(B.current.focus(),B.current.select())},[D]),(0,x.useEffect)(()=>{D||R(U)},[U,D]);let K=()=>{O(!0)},W=async()=>{if(!P.trim()){R(k),O(!1);return}G(P.trim()),O(!1);try{w.a.info("Valuation name saved",{name:P.trim()})}catch(e){w.a.error("Failed to save valuation name",{error:e})}},Y=()=>{R(k),O(!1)},q=e=>{null==C||C(e)},H=async()=>{try{w.a.info("Logging out user");let e=(void 0).VITE_BACKEND_URL||(void 0).VITE_API_BASE_URL||"https://web-production-8d00b.up.railway.app",t=await fetch("".concat(e,"/api/auth/logout"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});t.ok?w.a.info("Logout successful"):w.a.warn("Logout request failed",{status:t.status}),await _()}catch(e){w.a.error("Logout failed",{error:e}),await _()}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("nav",{className:"relative min-h-12 w-full shrink-0 flex items-center gap-2 px-4 py-2 border-b border-zinc-800/50 bg-zinc-950/50 backdrop-blur-sm overflow-visible",children:(0,a.jsx)("div",{className:"relative max-w-full gap-1 flex w-full shrink-0 items-center",children:(0,a.jsx)("div",{className:"w-full overflow-visible whitespace-nowrap scrollbar-hide",children:(0,a.jsxs)("div",{className:"relative flex w-full flex-shrink-0 items-center justify-between",children:[(0,a.jsx)("div",{className:"flex flex-shrink-0 items-center gap-2",style:{width:"23%"},children:(0,a.jsxs)("div",{className:"relative flex items-center gap-2 group",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-white",children:[b?(0,a.jsx)(s.Z,{className:"w-4 h-4 animate-spin text-white"}):(0,a.jsx)("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-harvest-500 to-harvest-600 animate-pulse shadow-[0_0_8px_rgba(217,165,88,0.5)]"}),D?(0,a.jsx)("input",{ref:B,type:"text",value:P,onChange:e=>R(e.target.value),onBlur:W,onKeyDown:e=>{"Enter"===e.key?W():"Escape"===e.key&&Y()},className:"bg-transparent border-none outline-none focus:outline-none focus:ring-0 focus:border-none text-transparent bg-clip-text bg-gradient-to-r from-harvest-400 to-harvest-500 font-semibold text-sm",style:{minWidth:"120px"}}):(0,a.jsx)("button",{onClick:K,className:"hidden md:block font-semibold text-transparent bg-clip-text bg-gradient-to-r from-harvest-400 to-harvest-500 hover:from-harvest-300 hover:to-harvest-400 transition-all duration-200 cursor-pointer hover:scale-105 drop-shadow-[0_1px_3px_rgba(217,165,88,0.4)]",title:"Click to edit valuation name",children:U}),(0,a.jsx)("button",{onClick:K,className:"md:hidden text-xs text-harvest-400 font-bold hover:text-harvest-300 transition-colors cursor-pointer",title:"Click to edit valuation name",children:"Valuation"})]}),(0,a.jsx)("div",{className:"hidden md:block text-xs text-zinc-500 opacity-0 group-hover:opacity-100 transition-opacity",children:"✏️"})]})}),(0,a.jsxs)("div",{className:"absolute left-1/2 transform -translate-x-1/2 flex items-center gap-1",children:[(0,a.jsx)(y,{content:"Manual Input",position:"bottom",className:"",children:(0,a.jsx)("button",{onClick:()=>F("manual"),disabled:(null==S?void 0:S.currentView)==="manual"||A,className:"p-2 rounded-lg transition-all duration-200 ".concat((null==S?void 0:S.currentView)==="manual"?"bg-zinc-700 text-white":"text-gray-400 hover:text-gray-300 hover:bg-zinc-800"," ").concat(A?"opacity-50 cursor-not-allowed":""),children:A&&(null==S?void 0:S.currentView)!=="manual"?(0,a.jsx)(s.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(i.Z,{className:"w-4 h-4"})})}),(0,a.jsx)(y,{content:"Conversational Mode",position:"bottom",className:"",children:(0,a.jsx)("button",{onClick:()=>F("conversational"),disabled:(null==S?void 0:S.currentView)==="conversational"||A,className:"p-2 rounded-lg transition-all duration-200 ".concat((null==S?void 0:S.currentView)==="conversational"?"bg-zinc-700 text-white":"text-gray-400 hover:text-gray-300 hover:bg-zinc-800"," ").concat(A?"opacity-50 cursor-not-allowed":""),children:A&&(null==S?void 0:S.currentView)!=="conversational"?(0,a.jsx)(s.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(r.Z,{className:"w-4 h-4"})})}),(0,a.jsx)("div",{className:"mx-2 h-6 w-px bg-zinc-700"}),(0,a.jsx)(y,{content:"Preview",position:"bottom",className:"",children:(0,a.jsx)("button",{onClick:()=>q("preview"),className:"p-2 rounded-lg transition-all duration-200 ".concat("preview"===z?"bg-zinc-700 text-white":"text-gray-400 hover:text-gray-300 hover:bg-zinc-800"),children:(0,a.jsx)(o.Z,{className:"w-4 h-4"})})}),(0,a.jsx)(y,{content:"Source Code",position:"bottom",className:"",children:(0,a.jsx)("button",{onClick:()=>q("source"),className:"p-2 rounded-lg transition-all duration-200 ".concat("source"===z?"bg-zinc-700 text-white":"text-gray-400 hover:text-gray-300 hover:bg-zinc-800"),children:(0,a.jsx)(l.Z,{className:"w-4 h-4"})})}),(0,a.jsx)(y,{content:"Valuation Info",position:"bottom",className:"",children:(0,a.jsx)("button",{onClick:()=>q("info"),className:"p-2 rounded-lg transition-all duration-200 ".concat("info"===z?"bg-zinc-700 text-white":"text-gray-400 hover:text-gray-300 hover:bg-zinc-800"),children:(0,a.jsx)(c.Z,{className:"w-4 h-4"})})}),(0,a.jsx)("div",{className:"mx-2 h-6 w-px bg-zinc-700"}),(0,a.jsx)(y,{content:"Refresh",position:"bottom",className:"",children:(0,a.jsx)("button",{onClick:t,className:"p-2 rounded-lg transition-all duration-200 text-gray-400 hover:text-gray-300 hover:bg-zinc-800",disabled:b,children:(0,a.jsx)(d.Z,{className:"w-4 h-4"})})}),(0,a.jsx)(y,{content:"Download PDF",position:"bottom",className:"",children:(0,a.jsx)("button",{onClick:n,className:"p-2 rounded-lg transition-all duration-200 text-gray-400 hover:text-gray-300 hover:bg-zinc-800",children:(0,a.jsx)(u.Z,{className:"w-4 h-4"})})}),(0,a.jsx)(y,{content:"Open Full Screen",position:"bottom",className:"",children:(0,a.jsx)("button",{onClick:g,className:"p-2 rounded-lg transition-all duration-200 text-gray-400 hover:text-gray-300 hover:bg-zinc-800",children:(0,a.jsx)(m.Z,{className:"w-4 h-4"})})})]}),(0,a.jsx)("div",{className:"flex items-center gap-1.5",children:(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsx)(j.w,{user:N,onLogout:H})})})]})})})}),(0,a.jsx)(f,{isOpen:Z,currentFlow:(null==S?void 0:S.currentView)||"manual",targetFlow:T||"manual",onConfirm:M,onClose:()=>{I(!1),V(null)}})]})}}}]);