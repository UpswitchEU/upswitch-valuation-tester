"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{65892:function(e,a,l){l.r(a),l.d(a,{ValuationFlow:function(){return m}});var n=l(57437),o=l(2265),s=l(30761),t=l(38691),i=l(69419);let r=(0,o.lazy)(()=>l.e(134).then(l.bind(l,31134)).then(e=>({default:e.Results}))),d=(0,o.lazy)(()=>Promise.all([l.e(4),l.e(216),l.e(493),l.e(404)]).then(l.bind(l,96629)).then(e=>({default:e.StreamingChat}))),c=(0,o.lazy)(()=>Promise.all([l.e(4),l.e(493),l.e(519)]).then(l.bind(l,519)).then(e=>({default:e.ValuationToolbar}))),u=(0,o.lazy)(()=>Promise.all([l.e(4),l.e(985)]).then(l.bind(l,9985)).then(e=>({default:e.DataCollection}))),f=e=>{let{message:a="Loading..."}=e;return(0,n.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"}),(0,n.jsx)("span",{className:"text-zinc-600",children:a})]})})},m=e=>{let{reportId:a,flowType:l,onComplete:o,initialQuery:s=null,autoSend:t=!1}=e;return"conversational"===l?(0,n.jsx)(x,{reportId:a,onComplete:o,initialQuery:s,autoSend:t}):(0,n.jsx)(h,{reportId:a,onComplete:o})},h=e=>{let{reportId:a,onComplete:d}=e,{result:m,isCalculating:h,calculateValuation:x,setCollectedData:p}=(0,t.useValuationStore)(),{user:v}=(0,s.a)(),b=(0,o.useCallback)(e=>{p(e)},[p]),j=(0,o.useCallback)(async e=>{p(e);try{await x()}catch(e){i.a.error("Valuation calculation failed",{error:e,reportId:a})}},[p,x,a]),w=(0,o.useCallback)(e=>{i.a.debug("Manual flow progress update",{progress:e.overallProgress,completedFields:e.completedFields,totalFields:e.totalFields})},[]);return(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)(f,{message:"Loading data collection..."}),children:(0,n.jsx)(u,{method:"manual_form",onDataCollected:b,onProgressUpdate:w,onComplete:j})})}),(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)(f,{message:"Loading toolbar..."}),children:(0,n.jsx)(c,{onRefresh:()=>window.location.reload(),onDownload:async()=>{if(m)try{let{DownloadService:e}=await Promise.all([l.e(216),l.e(493),l.e(673)]).then(l.bind(l,55673));await e.downloadPDF(m,{format:"pdf",filename:"valuation-".concat(Date.now(),".pdf")})}catch(e){i.a.error("PDF download failed",{error:e,reportId:a})}},onFullScreen:()=>{},isGenerating:h,user:v,valuationName:"Manual Valuation",valuationId:null==m?void 0:m.valuation_id,activeTab:"preview",onTabChange:()=>{}})}),m&&(0,n.jsx)("div",{className:"border-t border-gray-200",children:(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)(f,{message:"Loading results..."}),children:(0,n.jsx)(r,{})})})]})};h.displayName="ManualFlow",m.displayName="ValuationFlow";let x=e=>{let{reportId:a,onComplete:l,initialQuery:t=null,autoSend:r=!1}=e,{user:u}=(0,s.a)(),m=(0,o.useCallback)(e=>{l(e)},[l]);return(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)(f,{message:"Loading toolbar..."}),children:(0,n.jsx)(c,{onRefresh:()=>window.location.reload(),onDownload:async()=>{console.log("PDF download not yet implemented for conversational flow")},onFullScreen:()=>{},isGenerating:!1,user:u,valuationName:"Conversational Valuation",valuationId:void 0,activeTab:"preview",onTabChange:()=>{}})}),(0,n.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)(f,{message:"Loading chat..."}),children:(0,n.jsx)(d,{sessionId:a,userId:null==u?void 0:u.id,onValuationComplete:m,onValuationStart:()=>{i.a.info("Conversational valuation started",{reportId:a})},initialMessage:t,autoSend:r})})})]})};x.displayName="ConversationalFlow"}}]);