(()=>{var e={};e.id=697,e.ids=[697],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},98188:e=>{"use strict";e.exports=require("module")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},15673:e=>{"use strict";e.exports=require("node:events")},70612:e=>{"use strict";e.exports=require("node:os")},49411:e=>{"use strict";e.exports=require("node:path")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},28050:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>c,routeModule:()=>m,tree:()=>u}),r(64769),r(74600),r(96560);var s=r(23191),a=r(88716),n=r(37922),i=r.n(n),o=r(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let u=["",{children:["reports",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,64769)),"/Users/matthiasmandiau/Desktop/projects/current/upswitch/apps/upswitch-valuation-tester/app/reports/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,74600)),"/Users/matthiasmandiau/Desktop/projects/current/upswitch/apps/upswitch-valuation-tester/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,96560)),"/Users/matthiasmandiau/Desktop/projects/current/upswitch/apps/upswitch-valuation-tester/app/not-found.tsx"]}],c=["/Users/matthiasmandiau/Desktop/projects/current/upswitch/apps/upswitch-valuation-tester/app/reports/[id]/page.tsx"],d="/reports/[id]/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/reports/[id]/page",pathname:"/reports/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},84484:(e,t,r)=>{Promise.resolve().then(r.bind(r,92730))},92730:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var s=r(10326),a=r(17577),n=r.n(a),i=r(35047),o=r(33741);let l={async savePartialData(e,t){o.a.debug("Mock savePartialData called",{reportId:e,data:t})},getReport:async e=>(o.a.debug("Mock getReport called",{reportId:e}),{success:!1,data:null}),updateReport:async(e,t)=>(o.a.debug("Mock updateReport called",{reportId:e,data:t}),{success:!0,data:t}),async completeReport(e,t){o.a.debug("Mock completeReport called",{reportId:e,data:t})}};var u=r(84425),c=r(99701),d=r(37773);let p=(0,a.lazy)(()=>r.e(791).then(r.bind(r,34791)).then(e=>({default:e.ValuationFlow}))),m=n().memo(({session:e,stage:t,error:r,prefilledQuery:n,autoSend:i,onComplete:o})=>{let l=(0,a.useMemo)(()=>e?.currentView==="manual"?"manual":"conversational",[e?.currentView]),u=(0,a.useMemo)(()=>e?`${e.currentView}-flow`:"no-session-flow",[e?.currentView,e]);return"loading"===t?s.jsx(c.G,{steps:d.V,variant:"dark"}):r?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"max-w-md mx-auto text-center",children:(0,s.jsxs)("div",{className:"bg-rust-500/20 border border-rust-500/30 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-rust-400 mb-2",children:"Error"}),s.jsx("p",{className:"text-rust-300 mb-4",children:r}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-rust-600 hover:bg-rust-700 text-white rounded-lg transition-colors",children:"Reload Page"})]})})}):"data-entry"===t&&e?s.jsx("div",{className:"relative h-full w-full",children:s.jsx("div",{className:"absolute inset-0 animate-in fade-in duration-200 ease-out",children:s.jsx(a.Suspense,{fallback:null,children:s.jsx(p,{reportId:e.reportId,flowType:l,onComplete:o,initialQuery:n,autoSend:i})})},u)}):s.jsx("div",{className:"flex items-center justify-center h-full",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),s.jsx("p",{className:"text-zinc-400",children:"Loading valuation interface..."})]})})});m.displayName="ValuationFlowSelector";var f=r(74131),g=r(38450),y=r(31989),x=r(95541);let h=n().memo(({reportId:e,children:t})=>{let r=(0,i.useSearchParams)(),n=(0,i.usePathname)(),l=(0,i.useRouter)(),{isAuthenticated:u}=(0,f.a)(),{session:c,initializeSession:d}=(0,y.L)(),[p,m]=(0,a.useState)(""),[h,w]=(0,a.useState)("loading"),[b,v]=(0,a.useState)(null),[_,S]=(0,a.useState)(!1),j={},D=j.prefilledQuery||null,k=j.autoSend||!1,I=(0,a.useRef)(new Map),E=(0,a.useCallback)(async e=>{let t=I.current.get(e);if(!(t?.isInitializing||t?.initialized)){I.current.set(e,{initialized:!1,isInitializing:!0});try{if(!r)return;let t=r.get("flow"),s="manual"===t||"conversational"===t?t:"manual";if("conversational"===s&&!u&&!g.u.hasCredits()){S(!0),await d(e,"manual"),w("data-entry"),I.current.set(e,{initialized:!0,isInitializing:!1});return}await d(e,s,D),w("data-entry"),I.current.set(e,{initialized:!0,isInitializing:!1})}catch(t){I.current.set(e,{initialized:!1,isInitializing:!1}),o.a.error("Failed to initialize session",{error:t,reportId:e}),v("Failed to initialize valuation session")}}},[u,d,D,r]);return(0,a.useEffect)(()=>{e&&(p&&p!==e&&I.current.delete(p),m(e),E(e))},[e,E,p]),(0,a.useEffect)(()=>{if(!c?.currentView||!c?.reportId)return;let e=I.current.get(c.reportId);if(e?.initialized&&r&&r.get("flow")!==c.currentView){let e=new URLSearchParams(r.toString());e.set("flow",c.currentView),l.replace(`${n}?${e.toString()}`)}},[c?.currentView,c?.reportId,n,r,l]),(0,s.jsxs)(s.Fragment,{children:[t({session:c,stage:h,error:b,showOutOfCreditsModal:_,onCloseModal:()=>S(!1),prefilledQuery:D,autoSend:k}),s.jsx(x.o,{isOpen:_,onClose:()=>S(!1),onSignUp:()=>{S(!1),o.a.info("Sign up clicked from out of credits modal",{reportId:e})},onTryManual:async()=>{S(!1),c&&await y.L.getState().switchView("manual",!0,!0)}})]})});h.displayName="ValuationSessionManager";let w=n().memo(({reportId:e})=>{let t=(0,i.useRouter)(),r=async t=>{try{await l.completeReport(e,t)}catch(t){o.a.error("Failed to save completed valuation",{error:t,reportId:e})}};return(n().useEffect(()=>{if(!e||!(0,u.qi)(e)){let e=(0,u.rg)();t.replace(`/reports/${e}`)}},[e,t]),e&&(0,u.qi)(e))?s.jsx("div",{className:"flex h-screen w-screen flex-col overflow-hidden bg-zinc-950",children:s.jsx(a.Suspense,{fallback:s.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}),children:s.jsx(h,{reportId:e,children:({session:e,stage:t,error:a,showOutOfCreditsModal:n,onCloseModal:i,prefilledQuery:o,autoSend:l})=>s.jsx(m,{session:e,stage:t,error:a,prefilledQuery:o,autoSend:l,onComplete:r})})})}):null});function b({params:e}){let{id:t}=(0,a.use)(e);return s.jsx(w,{reportId:t})}w.displayName="ValuationReport"},62881:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var s=r(17577);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=(...e)=>e.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ");/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,s.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:o="",children:l,iconNode:u,...c},d)=>(0,s.createElement)("svg",{ref:d,...i,width:t,height:t,stroke:e,strokeWidth:a?24*Number(r)/Number(t):r,className:n("lucide",o),...c},[...u.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(l)?l:[l]])),l=(e,t)=>{let r=(0,s.forwardRef)(({className:r,...i},l)=>(0,s.createElement)(o,{ref:l,iconNode:t,className:n(`lucide-${a(e)}`,r),...i}));return r.displayName=`${e}`,r}},77506:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(62881).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},65442:(e,t,r)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=r(17577),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=s.useState,i=s.useEffect,o=s.useLayoutEffect,l=s.useDebugValue;function u(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!a(e,r)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),s=n({inst:{value:r,getSnapshot:t}}),a=s[0].inst,c=s[1];return o(function(){a.value=r,a.getSnapshot=t,u(a)&&c({inst:a})},[e,r,t]),i(function(){return u(a)&&c({inst:a}),e(function(){u(a)&&c({inst:a})})},[e]),l(r),r};t.useSyncExternalStore=void 0!==s.useSyncExternalStore?s.useSyncExternalStore:c},79251:(e,t,r)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=r(17577),a=r(94095),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=a.useSyncExternalStore,o=s.useRef,l=s.useEffect,u=s.useMemo,c=s.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,s,a){var d=o(null);if(null===d.current){var p={hasValue:!1,value:null};d.current=p}else p=d.current;var m=i(e,(d=u(function(){function e(e){if(!l){if(l=!0,i=e,e=s(e),void 0!==a&&p.hasValue){var t=p.value;if(a(t,e))return o=t}return o=e}if(t=o,n(i,e))return t;var r=s(e);return void 0!==a&&a(t,r)?(i=e,t):(i=e,o=r)}var i,o,l=!1,u=void 0===r?null:r;return[function(){return e(t())},null===u?void 0:function(){return e(u())}]},[t,r,s,a]))[0],d[1]);return l(function(){p.hasValue=!0,p.value=m},[m]),c(m),m}},94095:(e,t,r)=>{"use strict";e.exports=r(65442)},21508:(e,t,r)=>{"use strict";e.exports=r(79251)},37773:(e,t,r)=>{"use strict";r.d(t,{O:()=>s,V:()=>a});let s=[{text:"Assessing data quality...",subtext:"Evaluating completeness, validity, and consistency across 5 dimensions"},{text:"Validating financial metrics...",subtext:"Extracting revenue, EBITDA, and business profile data"},{text:"Consulting academic frameworks...",subtext:"Referencing Koller, Damodaran & IVS 2017 standards"},{text:"Selecting valuation methodology...",subtext:"Determining DCF vs. Market Multiples eligibility for SMEs"},{text:"Benchmarking against comparables...",subtext:"Analyzing industry multiples from real market transactions"},{text:"Calibrating SME risk factors...",subtext:"Assessing owner dependency, size discount, and liquidity"},{text:"Synthesizing final valuation...",subtext:"Generating Big 4-grade professional report with Belgian compliance"}],a=[{text:"Connecting to secure cloud...",subtext:"Establishing encrypted connection to Upswitch servers"},{text:"Initializing valuation engine...",subtext:"Loading financial modeling tools and market data"},{text:"Preparing workspace...",subtext:"Setting up your secure valuation environment"}]},99701:(e,t,r)=>{"use strict";r.d(t,{G:()=>o});var s=r(10326),a=r(77506),n=r(17577),i=r(37773);let o=({steps:e=i.O,variant:t="light",centered:r=!0,compact:o=!1,containerClassName:l})=>{let[u,c]=(0,n.useState)(0);(0,n.useEffect)(()=>{let t=setInterval(()=>{c(t=>(t+1)%e.length)},3e3);return()=>clearInterval(t)},[e.length]);let d=e[u],p="dark"===t;return(0,s.jsxs)("div",{className:l||`flex flex-col items-center w-full h-full max-w-lg mx-auto text-center ${r?"justify-center min-h-[300px] px-4 py-6":"justify-start min-h-[200px] px-4 py-2"}`,children:[(0,s.jsxs)("div",{className:`relative group ${r?"mb-2":"mb-1"}`,children:[s.jsx("div",{className:`absolute inset-0 rounded-full animate-ping ${p?"bg-primary-400/20":"bg-primary-500/10"}`,style:{animationDuration:"3s"}}),s.jsx("div",{className:`absolute inset-0 rounded-full animate-ping ${p?"bg-primary-300/10":"bg-primary-400/5"}`,style:{animationDuration:"4s",animationDelay:"1s"}}),s.jsx("div",{className:`relative p-6 rounded-2xl shadow-sm border z-10 flex items-center justify-center transform transition-all duration-500 ${p?"bg-zinc-900 border-zinc-800 shadow-primary-900/10":"bg-white border-gray-200 shadow-lg"}`,children:s.jsx(a.Z,{className:`w-10 h-10 animate-spin ${p?"text-primary-400":"text-primary-600"}`,strokeWidth:1.5})})]}),s.jsx("div",{className:`${o?"mt-0.5 mb-0.5":"mt-6 mb-3"} animate-in fade-in slide-in-from-bottom-2 duration-700 delay-100 fill-mode-backwards`,children:(0,s.jsxs)("span",{className:`text-xs font-semibold tracking-wide uppercase px-3 py-1.5 rounded-full ${p?"text-primary-300 bg-primary-900/30 border border-primary-800/50":"text-primary-700 bg-primary-50 border border-primary-100"}`,children:["Step ",u+1," of ",e.length]})}),(0,s.jsxs)("div",{className:"flex flex-col items-center max-w-md mx-auto text-center",children:[s.jsx("h3",{className:`text-xl md:text-2xl font-semibold tracking-tight animate-in fade-in slide-in-from-bottom-3 duration-500 text-center ${p?"text-white":"text-slate-ink"}`,children:d.text},`title-${u}`),s.jsx("p",{className:`mt-1.5 text-base leading-relaxed animate-in fade-in slide-in-from-bottom-4 duration-500 delay-75 text-center ${p?"text-zinc-400":"text-zinc-500"}`,children:d.subtext},`subtext-${u}`)]})]})}},95541:(e,t,r)=>{"use strict";r.d(t,{o:()=>a});var s=r(10326);r(17577);let a=({isOpen:e,onClose:t,onSignUp:r,onTryManual:a})=>e?s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-zinc-900 border border-zinc-700 rounded-2xl p-8 max-w-md w-full mx-4",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("span",{className:"text-red-400 text-2xl",children:"\uD83D\uDD12"})}),s.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"You've Used All 3 Free Credits!"}),s.jsx("p",{className:"text-zinc-400 mb-6",children:"You've completed 3 AI-guided valuations. Sign up to get 3 more free credits and save your reports forever."}),(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("button",{onClick:r,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-4 rounded-lg transition-colors",children:"Sign Up for Free (3 More Credits)"}),s.jsx("button",{onClick:a,className:"w-full bg-zinc-700 hover:bg-zinc-600 text-zinc-300 font-medium py-3 px-4 rounded-lg transition-colors",children:"Try Manual Entry (Always Free)"}),s.jsx("button",{onClick:t,className:"w-full text-zinc-500 hover:text-zinc-400 font-medium py-2 px-4 rounded-lg transition-colors",children:"Maybe Later"})]}),s.jsx("div",{className:"mt-6 p-4 bg-zinc-800/50 rounded-lg",children:(0,s.jsxs)("p",{className:"text-xs text-zinc-400",children:[s.jsx("span",{className:"text-green-400",children:"✓"})," Sign up is completely free",s.jsx("br",{}),s.jsx("span",{className:"text-green-400",children:"✓"})," Get 3 more AI-guided valuations",s.jsx("br",{}),s.jsx("span",{className:"text-green-400",children:"✓"})," Save reports forever",s.jsx("br",{}),s.jsx("span",{className:"text-green-400",children:"✓"})," No credit card required"]})})]})})}):null},74131:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var s=r(17577),a=r(68035);r(33741);let n=()=>{let e=(0,s.useContext)(a.V);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},38450:(e,t,r)=>{"use strict";r.d(t,{u:()=>a});let s="upswitch_guest_credits",a={getCredits(){let e=localStorage.getItem(s);return e?parseInt(e,10):(this.initializeCredits(),3)},initializeCredits(){localStorage.setItem(s,"3")},useCredit(){let e=this.getCredits();return!(e<=0)&&(localStorage.setItem(s,(e-1).toString()),!0)},hasCredits(){return this.getCredits()>0},resetCredits(){localStorage.setItem(s,"3")},setCredits(e){localStorage.setItem(s,Math.max(0,e).toString())},getCreditsRemaining(){return this.getCredits()},getCreditStatus(){let e=this.getCredits();return{remaining:e,total:3,hasCredits:e>0,isFirstTime:!localStorage.getItem(s)}}}},18243:(e,t,r)=>{"use strict";r.d(t,{P:()=>o});var s=r(60114),a=r(33741);let n=()=>Math.min(new Date().getFullYear(),2100),i={company_name:"",country_code:"BE",industry:"services",business_model:"services",founding_year:n()-5,business_type:"company",shares_for_sale:100,number_of_owners:1,revenue:void 0,ebitda:void 0,current_year_data:{year:n(),revenue:0,ebitda:0}},o=(0,s.Ue)((e,t)=>({collectedData:[],setCollectedData:t=>{a.sK.debug("Form store: Collected data updated",{dataPoints:t.length,fields:t.map(e=>e.fieldId)}),e({collectedData:t})},formData:i,updateFormData:t=>{a.sK.debug("Form store: Form data updated",{updatedFields:Object.keys(t)}),e(e=>({formData:{...e.formData,...t}}))},resetFormData:()=>{a.sK.info("Form store: Form data reset to defaults"),e({formData:i,collectedData:[]})},prefillFromBusinessCard:t=>{a.sK.info("Form store: Pre-filling form from business card",{companyName:t.company_name,industry:t.industry}),e(e=>({formData:{...e.formData,company_name:t.company_name,industry:t.industry,business_model:t.business_model,founding_year:t.founding_year,country_code:t.country_code,number_of_employees:t.employee_count}}))}}))},31989:(e,t,r)=>{"use strict";r.d(t,{L:()=>o});var s=r(60114),a=r(50694),n=r(33741),i=r(18243);let o=(0,s.Ue)((e,t)=>{let s=(e,t)=>{let r={...e};for(let a in t)t[a]&&"object"==typeof t[a]&&!Array.isArray(t[a])?r[a]=s(e[a]||{},t[a]):r[a]=t[a];return r};return{session:null,isSyncing:!1,syncError:null,pendingFlowSwitch:null,initializeSession:async(r,s="manual",i)=>{try{n.sK.info("Initializing valuation session",{reportId:r,currentView:s,hasPrefilledQuery:!!i});let{session:o}=t();if(o?.reportId===r&&o.currentView){if(n.sK.info("Session already exists locally, skipping initialization",{reportId:r,existingView:o.currentView,requestedView:s}),i&&o.partialData){let t={...o.partialData};t._prefilledQuery||(t._prefilledQuery=i,e({session:{...o,partialData:t}}))}return}let l=await a.T.getValuationSession(r);if(l){let t=l.session,s={...t.partialData||{}};i&&!s._prefilledQuery&&(s._prefilledQuery=i),e({session:{...t,partialData:s,createdAt:t.createdAt?new Date(t.createdAt):new Date,updatedAt:t.updatedAt?new Date(t.updatedAt):new Date,completedAt:t.completedAt?new Date(t.completedAt):void 0}}),n.sK.info("Loaded existing session",{reportId:r,currentView:t.currentView})}else{let t=`session_${Date.now()}_${Math.random().toString(36).substring(2,15)}`,o={sessionId:t,reportId:r,currentView:s,dataSource:s,createdAt:new Date,updatedAt:new Date,partialData:i?{_prefilledQuery:i}:{},sessionData:{}};await a.T.createValuationSession(o),e({session:o}),n.sK.info("Created new session",{reportId:r,sessionId:t,currentView:s,hasPrefilledQuery:!!i})}}catch(a){n.sK.error("Failed to initialize session",{error:a instanceof Error?a.message:"Unknown error",reportId:r});let t=`session_${Date.now()}_${Math.random().toString(36).substring(2,15)}`;e({session:{sessionId:t,reportId:r,currentView:s,dataSource:s,createdAt:new Date,updatedAt:new Date,partialData:{},sessionData:{}}}),n.sK.warn("Created local session (backend sync failed)",{reportId:r,sessionId:t})}},loadSession:async t=>{try{e({isSyncing:!0,syncError:null});let r=await a.T.getValuationSession(t);if(r&&r.session){let s=r.session;e({session:{...s,createdAt:s.createdAt?new Date(s.createdAt):new Date,updatedAt:s.updatedAt?new Date(s.updatedAt):new Date,completedAt:s.completedAt?new Date(s.completedAt):void 0}}),n.sK.info("Session loaded",{reportId:t})}}catch(e){n.sK.error("Failed to load session",{error:e instanceof Error?e.message:"Unknown error",reportId:t})}},updateSessionData:async r=>{let{session:i}=t();if(!i){n.sK.warn("Cannot update session data: no active session");return}try{let o=s(i.partialData,r),l=s(i.sessionData||{},r),u=i.dataSource;i.dataSource!==i.currentView&&(u="mixed");let c={...i,partialData:o,sessionData:l,dataSource:u,updatedAt:new Date},d={...i,sessionData:l};e({session:d});let p=t().getCompleteness();c.completeness=p,await a.T.updateValuationSession(i.reportId,{partialData:o,sessionData:l,dataSource:u,currentView:i.currentView}),e({session:c,isSyncing:!1,syncError:null}),n.sK.debug("Session data updated",{reportId:i.reportId,fieldsUpdated:Object.keys(r),completeness:p})}catch(c){n.sK.error("Failed to update session data",{error:c instanceof Error?c.message:"Unknown error",reportId:i.reportId});let s=(e,t)=>{let r={...e};for(let a in t)t[a]&&"object"==typeof t[a]&&!Array.isArray(t[a])?r[a]=s(e[a]||{},t[a]):r[a]=t[a];return r},a=s(i.partialData,r),o=s(i.sessionData||{},r),l=i.dataSource;i.dataSource!==i.currentView&&(l="mixed"),e({session:{...i,sessionData:o}});let u=t().getCompleteness();e({session:{...i,partialData:a,sessionData:o,dataSource:l,updatedAt:new Date,completeness:u}})}},switchView:async(s,i=!0,o=!1)=>{let{session:l}=t();if(!l){n.sK.warn("Cannot switch view: no active session");return}if(l.currentView===s){n.sK.debug("Already in target view",{reportId:l.reportId,view:s});return}if(!o)return n.sK.info("Flow switch requires confirmation",{reportId:l.reportId,currentView:l.currentView,targetView:s,resetData:i}),e({pendingFlowSwitch:s}),{needsConfirmation:!0};let u=!1;if(e(e=>e.isSyncing?(n.sK.warn("Switch already in progress, ignoring concurrent request",{reportId:l.reportId,requestedView:s}),e):(u=!0,{...e,isSyncing:!0,syncError:null})),!u)return;try{let{useValuationResultsStore:e}=await r.e(202).then(r.bind(r,97202));e.getState().clearResult(),n.sK.info("Cleared valuation result on flow switch",{from:l.currentView,to:s})}catch(e){n.sK.error("Failed to clear result on flow switch",{error:e})}e({pendingFlowSwitch:null});let{session:c}=t();if(!c||c.reportId!==l.reportId){n.sK.warn("Session changed during switch, aborting",{originalReportId:l.reportId}),e({isSyncing:!1});return}if(c.currentView===s){n.sK.debug("Already in target view (race condition check)",{reportId:c.reportId,view:s}),e({isSyncing:!1});return}let d={...c},p={...c,currentView:s,updatedAt:new Date};if(i){let e=c.partialData?._prefilledQuery;p.partialData=e?{_prefilledQuery:e}:{},p.sessionData={},p.dataSource=s,n.sK.info("Resetting session data on flow switch",{reportId:c.reportId,preservedPrefilledQuery:!!e})}e({session:p}),n.sK.info("View switched optimistically (UI updated immediately)",{reportId:c.reportId,from:c.currentView,to:s,resetData:i}),a.T.switchValuationView(c.reportId,s).then(()=>{let{session:e}=t();e?.reportId===c.reportId&&n.sK.info("Backend sync completed successfully",{reportId:c.reportId,view:s})}).catch(r=>{n.sK.error("Failed to sync view switch with backend",{error:r instanceof Error?r.message:"Unknown error",reportId:c.reportId,requestedView:s});let{session:a}=t();a?.reportId===c.reportId&&(e({session:d}),n.sK.warn("Rolled back view switch due to backend error",{reportId:c.reportId,originalView:d.currentView}))})},getSessionData:()=>{let{session:e}=t();if(!e||!e.sessionData)return null;let r=e.sessionData,s=(e,t)=>null!=e&&("string"!=typeof e||""!==e.trim())&&("number"==typeof e?!!(0!==e||["ebitda"].includes(t||"")):(!Array.isArray(e)||0!==e.length)&&("object"!=typeof e||null===e||0!==Object.keys(e).length)),a={};for(let[e,t]of Object.entries(r))if("current_year_data"===e&&"object"==typeof t&&null!==t){let r={};for(let[e,a]of Object.entries(t))s(a)&&(r[e]=a);Object.keys(r).length>0&&(a[e]=r)}else s(t,e)&&(a[e]=t);return 0===Object.keys(a).length?null:a},clearSession:()=>{e({session:null,isSyncing:!1,syncError:null}),n.sK.info("Session cleared")},syncFromManualForm:async()=>{let{session:r}=t();if(!r){n.sK.warn("Cannot sync from manual form: no active session");return}try{e({isSyncing:!0,syncError:null});let s=i.P.getState().formData,a={company_name:s.company_name,country_code:s.country_code,industry:s.industry,business_model:s.business_model,founding_year:s.founding_year,current_year_data:s.current_year_data,historical_years_data:s.historical_years_data,number_of_employees:s.number_of_employees,number_of_owners:s.number_of_owners,recurring_revenue_percentage:s.recurring_revenue_percentage,shares_for_sale:s.shares_for_sale,business_type_id:s.business_type_id,business_context:s.business_context,comparables:s.comparables};Object.keys(a).forEach(e=>{void 0===a[e]&&delete a[e]}),await t().updateSessionData(a),n.sK.info("Synced from manual form to session",{reportId:r.reportId,fieldsUpdated:Object.keys(a).length}),e({isSyncing:!1,syncError:null})}catch(t){n.sK.error("Failed to sync from manual form",{error:t instanceof Error?t.message:"Unknown error"}),e({isSyncing:!1,syncError:t instanceof Error?t.message:"Failed to sync from manual form"})}},syncToManualForm:()=>{let{session:e}=t();if(!e||!e.sessionData){n.sK.warn("Cannot sync to manual form: no session data");return}try{let t=i.P.getState(),r=e.sessionData,s={company_name:r.company_name,country_code:r.country_code,industry:r.industry,business_model:r.business_model,founding_year:r.founding_year,current_year_data:r.current_year_data,historical_years_data:r.historical_years_data,number_of_employees:r.number_of_employees,number_of_owners:r.number_of_owners,recurring_revenue_percentage:r.recurring_revenue_percentage,shares_for_sale:r.shares_for_sale,business_type_id:r.business_type_id,business_context:r.business_context,comparables:r.comparables};Object.keys(s).forEach(e=>{void 0===s[e]&&delete s[e]}),t.updateFormData(s),n.sK.info("Synced from session to manual form",{reportId:e.reportId,fieldsUpdated:Object.keys(s).length})}catch(e){n.sK.error("Failed to sync to manual form",{error:e instanceof Error?e.message:"Unknown error"})}},getCompleteness:()=>{let{session:e}=t();if(!e||!e.sessionData)return 0;let r=e.sessionData,s=0,a=0;return[{key:"company_name",weight:1},{key:"country_code",weight:1},{key:"industry",weight:1},{key:"business_model",weight:1},{key:"founding_year",weight:1},{key:"current_year_data.revenue",weight:2},{key:"current_year_data.ebitda",weight:2}].forEach(({key:e,weight:t})=>{if(a+=t,e.includes(".")){let[a,n]=e.split(".");r[a]&&void 0!==r[a][n]&&null!==r[a][n]&&""!==r[a][n]&&(s+=t)}else void 0!==r[e]&&null!==r[e]&&""!==r[e]&&(s+=t)}),a>0?Math.round(s/a*100):0},setPendingFlowSwitch:t=>{e({pendingFlowSwitch:t})}}})},84425:(e,t,r)=>{"use strict";r.d(t,{qi:()=>a,rg:()=>s});let s=()=>{let e=Date.now(),t=Math.random().toString(36).substr(2,9);return`val_${e}_${t}`},a=e=>/^val_\d+_[a-z0-9]+$/.test(e)},64769:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>o});var s=r(68570);let a=(0,s.createProxy)(String.raw`/Users/matthiasmandiau/Desktop/projects/current/upswitch/apps/upswitch-valuation-tester/app/reports/[id]/page.tsx`),{__esModule:n,$$typeof:i}=a;a.default;let o=(0,s.createProxy)(String.raw`/Users/matthiasmandiau/Desktop/projects/current/upswitch/apps/upswitch-valuation-tester/app/reports/[id]/page.tsx#default`)},60114:(e,t,r)=>{"use strict";r.d(t,{Ue:()=>p});let s=e=>{let t;let r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,n={setState:s,getState:a,getInitialState:()=>i,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},i=t=e(s,a,n);return n},a=e=>e?s(e):s;var n=r(17577),i=r(21508);let{useDebugValue:o}=n,{useSyncExternalStoreWithSelector:l}=i,u=!1,c=e=>e,d=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?a(e):e,r=(e,r)=>(function(e,t=c,r){r&&!u&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),u=!0);let s=l(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return o(s),s})(t,e,r);return Object.assign(r,t),r},p=e=>e?d(e):d}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,939,496],()=>r(28050));module.exports=s})();